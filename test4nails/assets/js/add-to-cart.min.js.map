{"version":3,"sources":["add-to-cart.js"],"names":["url","SharedData","adminAjax","addToCart","id","$btn","arguments","length","undefined","data","action","qty","res","JSON","parse","status","$","updateModal","hide","modal","trigger","Fancybox","show","type","val","done","removeClass","replaceWith","destroy","src","fancybox","slide","updateCart","$cart","document","ajaxComplete","first","text","stop","addClass","watch","on","e","current","currentTarget","input","parent","find","max","attr","enable","Math","abs","parseInt","hasClass","value","bodyClass","removeAttr","body","console","log","click","preventDefault","closest","jQuery","setTimeout"],"mappings":"aAAA,IAAAA,IAAAC,WAAAC,UAKA,SAASC,UAAUC,GAAmB,IAANC,EAAI,EAAAC,UAAAC,OAAAD,UAAA,QAAAE,EADpCC,EAAA,CACAC,OAASP,cAAcQ,WAAGL,EAAMD,IAAN,EAAAC,UAAAC,aAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GAErBI,EAAAA,SAAQ,WAERC,EAAAA,KAAAA,IAAAA,EAAAA,SAAAA,GAEoB,QADvBC,EAAAC,KAAAC,MAAAF,IACaG,SAEJC,EAAEP,gBAAOG,OACTC,EAAI,QAAOD,QAAI,uBACbG,UACFE,YAAgBC,EAAIC,QAEb,UAATC,EAASL,SACTE,EAAAA,SAAgBE,MAAMC,QAAA,kBAC1BC,SAAAC,KAAA,CACc,CACOF,IAAAA,kBAETG,KAAA,YAIPP,EAAA,mBAAAQ,IAAAR,EAAA,gBAAAP,KAAA,aAELgB,KAAA,WACDA,EAAKC,YAAM,WACNrB,EAACqB,SAAY,WAQzB,SACMN,UAGNJ,EAAA,4BAAAI,QAAA,SAGA,SAKQC,YACQF,GAEII,UAAM,sBAEdP,EAAA,4BAAAW,YAAAR,GAGQS,SAASN,KAAA,CAGb,CAEPO,IAAA,eAELN,KAAA,WAGQ,CAEId,GAAKU,CAGTS,QAAY,SAAAE,EAAAC,SAiBxB,SAcwDC,aACvD,IAAMC,EAAAjB,EAAA,cACDkB,EAAUC,EAAAA,KAAAA,wBAAaC,QAAAC,OAAArB,EAAA,qBAAsBsB,KAAI3B,GAAG,EAAAA,EAAAsB,EAAAM,SAAA,UAAAN,EAAAP,YAAA,UAK1D,SAYMc,QACNxB,EAAA,QAAAyB,GAAA,QAAA,WAAA,SAAAC,GAEQA,EAAED,iBACA,IAAEE,EAAA3B,EAAA0B,EAAAE,eACCC,EAAAF,EAAAG,SAAAC,KAAA,SACXC,EAAAH,EAAAI,KAAA,OAEOC,EAASC,KAAAC,IAAAC,SAAAR,EAAArB,QACZmB,EAAAW,SAAA,kBAAuCC,EAAUP,EAEvDH,EAAArB,MAAA+B,GAAAnC,QAAA,UAEcuB,EAAAW,SAAoBE,mBAA4B,EAAlBD,GAC9BV,EAACrB,MAAA+B,GAAAnC,QAAA,YASf,SAAA8B,SACAlC,EAAA,4BAAAyC,WAAA,YAlHAzC,EAAAkB,SAAAwB,MAAAjB,GAAA,iBAAA,cAoDAzB,EAAA,QAAAyB,GAAA,gBAAA,SAAAC,EAAAjC,GAEAQ,YAAAR,EAAAU,SAGAwC,QAAAC,IAAS5B,aACLwB,UAAYxC,mBAEVA,EAAA,iDAA8B6C,MAAA,SAAAnB,GAChC/B,EAAGmD,iBACP,IAAAzD,EAAAW,EAAA0B,EAAAE,eAGIzC,UAnBSE,EAAKmB,MAkBlBnB,EAAA0D,QAAA,QAAAhB,KAAA,mBAAAvB,MACenB,KAAVmD,UAAU,oBAoBPxC,EAAAkB,UAAYoB,aAAS,WAAA,OAAAtC,EAAA,cAAuBsB,SAPpDtB,EAAA,QAAcwB,GAAG,kCAAA,WAEPsB,WAAAA,WAAAA,OAAgB9B,cAAA,OAClBS,GAAME,QAAW,2BAAiB,WAC5BE,EAAAA,cAAgBC,KAAAA,iBAAsBP,SAAA,kBAC5CE,GAAMO,0BAAsB,WAAA,OAAAhB,eAUpChB,EAAE,QAcYyB,GAAE,SAAA,OAAA,WACVS,SAEFc,aAQJR,UAAA,mBAAAA,UAAA,uBACAS,WAAA,WAAA,OAAAf,WACAV,QACAwB,OAAA9B,SAAAwB,MAAAjB,GAAA,sBAAA,WACAS,WAGAc,OAAA9B,SAAAwB,MAAAjB,GAAA,oBAAA,WACAS","file":"add-to-cart.min.js","sourcesContent":["/*ADD TO CART BUTTON*/\r\n\r\nconst url = SharedData.adminAjax;\r\n\r\n// add to cart function\r\nfunction addToCart(id, qty = 1, $btn) {\r\n    let data = {\r\n        action: 'add_to_cart',\r\n        product_id: id,\r\n        qty\r\n    };\r\n    $btn.addClass('loading');\r\n\r\n    $.post(url, data, (res) => {\r\n        res = JSON.parse(res);\r\n        if (res.status === 'ok') {\r\n            $('.count-error').hide();\r\n            $('body').trigger('wc_fragment_refresh');\r\n            trigger();\r\n            updateModal(res.modal);\r\n        }\r\n        if (res.status === 'error') {\r\n            $(document.body).trigger('checkout_error');\r\n            Fancybox.show([\r\n                    {\r\n                        src: \"#quantity-modal\",\r\n                        type: \"inline\"\r\n                    }]\r\n            );\r\n            $('.product__value').val($('.count-error').data('count'));\r\n        }\r\n    }).done(() => {\r\n        $btn.removeClass('loading');\r\n        $btn.addClass('added');\r\n    });\r\n}\r\n$(document.body).on('checkout_error', function () {\r\n\r\n});\r\n// trigger add to cart events\r\nfunction trigger() {\r\n    $(':input[name=update_cart]').trigger(\"click\");\r\n\r\n\r\n}\r\n\r\n// Insert data into modal and show modal window\r\nfunction updateModal(modal) {\r\n\r\n    if (!bodyClass('woocommerce-cart')) {\r\n        $('#addedToCart .modal-body').replaceWith(modal);\r\n\r\n        Fancybox.show([\r\n                {\r\n                    src: \"#addedToCart\",\r\n                    type: \"inline\"\r\n                }],\r\n            {\r\n                on: {\r\n\r\n                    destroy: (fancybox, slide) => {\r\n\r\n                    },\r\n                },\r\n            }\r\n        );\r\n\r\n    }\r\n}\r\n\r\n$('body').on('added_to_cart', (e, data) => {\r\n\r\n    updateModal(data.modal);\r\n\r\n});\r\nconsole.log('imworking')\r\nif (bodyClass('single-product')) {\r\n\r\n    $('button.add-to-cart:not(.add-to-cart-variable)').click((e) => {\r\n    e.preventDefault();\r\n    let $btn = $(e.currentTarget),\r\n        id = $btn.val(),\r\n        count = $btn.closest('form').find('.product__value').val();\r\n    addToCart(id, count, $btn);\r\n\r\n});\r\n}\r\n/* END ADD BUTTON*/\r\n\r\n/* MINI CART*/\r\n\r\n// Update mini cart\r\nfunction updateCart() {\r\n    let $cart = $('.mini-cart'),\r\n        qty = $cart.find('.cart-fragments .qty').first().text();\r\n    $('.product-quantity').html(qty);\r\n    qty > 0 ? $cart.addClass('active') : $cart.removeClass('active');\r\n}\r\n\r\n// Add update mini cart events\r\nif (!bodyClass('woocommerce-cart')) {\r\n    $('body').on('removed_from_cart added_to_cart', () => {\r\n\r\n        setTimeout(() => updateCart(), 1000);\r\n    }).on('click', '.remove_from_cart_button', () => {\r\n        $('.mini-cart').find('.mini-content').addClass('blockOverlay');\r\n    }).on('wc_fragments_refreshed ', () => updateCart());\r\n} else {\r\n    $(document).ajaxComplete(() => $('html, body').stop());\r\n}\r\n\r\n/* END MINI CART*/\r\n\r\nfunction watch() {\r\n    $('body').on('click', '.qty-btn', (e) => {\r\n        e.preventDefault();\r\n        const current = $(e.currentTarget);\r\n        const input = current.parent().find('input');\r\n        const max= input.attr('max');\r\n        let value = Math.abs(parseInt(input.val()));\r\n        if (current.hasClass('product__plus')&&value<max) {\r\n            input.val(++value).trigger(\"change\");\r\n        } else if (current.hasClass('product__minus')&&value > 0) {\r\n            input.val(--value).trigger(\"change\");\r\n        }\r\n    });\r\n}\r\n\r\n$('body').on('change', '.qty', () => {\r\n    enable();\r\n    trigger();\r\n});\r\n\r\nfunction enable() {\r\n    $(':input[name=update_cart]').removeAttr('disabled');\r\n\r\n}\r\n\r\nif (bodyClass('single-product')|| bodyClass('woocommerce-cart')) {\r\n    setTimeout(() => enable());\r\n    watch();\r\n    jQuery(document.body).on('updated_cart_totals', () => {\r\n        enable();\r\n    });\r\n\r\n    jQuery(document.body).on('removed_from_cart', () => {\r\n        enable();\r\n    });\r\n}\r\n/*\r\nfunction  variable() {\r\n    const $input = $('.variation-items input:checked');\r\n    if ($input.length) {\r\n        const variation = $input.val();\r\n        const id = $('.product').data('id');\r\n        const quantity = $('.quantity input').val();\r\n\r\n        let link = location.protocol + '//' + location.host + location.pathname;\r\n        link += '?add-to-cart=' + id + '&variation_id=' + variation + '&quantity=' + quantity;\r\n        $('.product .add-to-cart').attr('href', link);\r\n\r\n        const name = $input.data('name'),\r\n            price = $input.data('price'),\r\n            oldPrice = $input.data('old-price'),\r\n            sku = $input.data('sku');\r\n        $('.variation-name').text(name);\r\n        $('.product-price .woocommerce-Price-amount').replaceWith(price);\r\n        $('.product-old-price .woocommerce-Price-amount').replaceWith(oldPrice);\r\n        $('.product__number span').text(sku);\r\n    }\r\n}\r\nfunction gallery() {\r\n    $('.variation-items input').click(function () {\r\n            let src = $(this).attr('data-gallery'),\r\n            $main = $('.gallery .main-photo');\r\n        console.log(123123);\r\n\r\n        if ($main.attr('href') !== src) {\r\n            $('.thumbnail.active').removeClass('active');\r\n            $(this).addClass('active');\r\n            $main.fadeOut(function () {\r\n                $(this).attr('href', src);\r\n                $(this).css('background-image', `url('${src}')`);\r\n                $(this).fadeIn();\r\n            });\r\n        }\r\n    });\r\n\r\n}\r\nif (bodyClass('single-product')) {\r\n    gallery();\r\n    $('button.add-to-cart:not(.add-to-cart-variable)').click((e) => {\r\n        console.log('qwewqe');\r\n        e.preventDefault();\r\n        let $btn = $(e.currentTarget),\r\n            id = $btn.val(),\r\n            count = $btn.closest('form').find('.qty').val();\r\n        this.addToCart(id, count, $btn);\r\n    });\r\n}\r\n\r\n*/"]}